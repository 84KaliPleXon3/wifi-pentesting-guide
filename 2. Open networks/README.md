# 2. Open networks

## 2.1. Captive portals

### 2.1.1. Fake captive portals


1. Clone a website using [HTTrack](https://www.httrack.com/) 

2. Install [Wifiphiser](https://github.com/wifiphisher/wifiphisher). Add the HTTrack result in a new folder in *wifiphisher/data/phishing-pages/*$NEW_PAGE*/html* and a configuration file in  *wifiphisher/data/phishing-pages/*new_page*/config.ini*. *NOTE: Check the other phishing pages examples to see how this can be done.*

3. Recompile the project using *python setup.py install* or the binary in *bin*. 

4. This command works correctly in the latest Kali release after installing hostapd:

```
cd bin && ./wifiphisher -aI $IFACE -e $ESSID --force-hostapd -p $PLUGIN -nE
```

---------------------------------------------


### 2.1.2. Bypass 1: MAC spoofing

The first method to bypass a captive portal is to change your MAC address to one of an already authenticated user

1. Scan the network and get the list of IP and MAC addresses. You can use:

- nmap

- A custom script like [this](scripts/captive-portal-bypass/get_mac_ip.sh) (Bash) or [this](scripts/captive-portal-bypass/get_mac_ip.py) (Python)

2. Change your IP and MAC addresses. You can use:

- macchanger

- A custom script like [this](scripts/captive-portal-bypass/change_mac_ip.sh)(Bash)


Also, you can use scripts to automate the process like:

- [Poliva script](https://raw.githubusercontent.com/poliva/random-scripts/master/wifi/hotspot-bypass.sh)

- [Hackcaptiveportals](https://github.com/systematicat/hack-captive-portals)

---------------------------------------------


### 2.1.3. Bypass 2: DNS tunnelling

A second method is creating a DNS tunnel. For this, it is necessary to have an accessible DNS server of your own. You can use this method to bypass the captive portal and get "free" Wifi in hotel, airports...


1. Check the domain names are resolved:

```
nslookup example.com
```

2. Create 2 DNS records (in [Digital ocean](https://www.digitalocean.com/), [Afraid.org](http://freedns.afraid.org/)...):

- One "A record":  dns.$DOMAIN pointing to the $SERVER_IP (Example: dns.domain.com 139.59.172.117)

- One "NS record": hack.$DOMAIN pointing to dns.$DOMAIN (Example: hack.domain.com dns.domain.com)


3. Execution in the server

```
iodined -f -c -P $PASS -n $SERVER_IP 10.0.0.1 hack.$DOMAIN
```

4. Check if it works correctly in [here](https://code.kryo.se/iodine/check-it/)


5. Execution in the client

```
iodine -f -P $PASS $DNS_SERVER_IP hack.$DOMAIN
```

6. Create the tunnel

```
ssh -D 8080 $USER@10.0.0.1
```


## 2.2. Man in the Middle attack

Once you are in the network, you can test if it is vulnerable to Man in the Middle attacks.

1. ARP Spoofing attack using [Ettercap](https://www.ettercap-project.org/)

2. Sniff the traffic using Wireshark or TCPdump

3. Analyze the traffic using [Network Miner](https://www.netresec.com/?page=networkminer)
